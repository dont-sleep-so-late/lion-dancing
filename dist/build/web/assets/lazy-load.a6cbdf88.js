import{m as a,am as e,b as s,ak as t,u as o,c as l,f as r,r as n,o as i,n as d,q as c,j as u,af as m,s as g,v as h,B as v,z as p,A as y,C as f,F as _,y as b,T as w,E as S,D as I,H as L,N as T,_ as $}from"./index-a52e8601.js";import{u as z}from"./index.a9b2a551.js";const k=s({src:String,height:String,width:String,mode:{type:String,values:t,default:"aspectFill"},threshold:{type:Number,default:100},transition:{type:Boolean,default:!0}}),x=s=>{const t=a(),{emit:o}=t,{getSelectorNodeInfo:r}=z(t),{connectObserver:g,disconnectObserver:h}=(s=>{var t;s||(s=a()),s=null==(t=null==s?void 0:s.proxy)?void 0:t.$parent;let o=null;const l=()=>{o&&(o.disconnect(),o=null)};return{connectObserver:(a,t,r,n)=>{l(),o=e(s,n),"relativeTo"===r.type?o.relativeTo((null==r?void 0:r.selector)||"",r.margins):"relativeToViewport"===r.type&&o.relativeToViewport(r.margins),o.observe(a,(a=>{t&&t(a)}))},disconnectObserver:l}})(t),v=`tll-${u()}`,p=l((()=>m(s.threshold,100))),y=n("waiting"),f=n(!1);let _=0;const b=async()=>{h();try{await r(`#${v}`),_=0;const a=p.value<0?-Math.abs(p.value):Math.abs(p.value);g(`#${v}`,(a=>{a.intersectionRatio>0&&(f.value=!0,y.value="loading",h())}),{type:"relativeToViewport",margins:{bottom:a}})}catch(a){if(_>10)return void(_=0);_++,setTimeout((()=>{b()}),150)}};return i((()=>{d((()=>{b()}))})),c((()=>{h()})),{componentId:v,imageStatus:y,showImage:f,handleImageLoadedSuccess:()=>{y.value="loaded",o("loaded")},handleImageLoadedFailed:a=>{y.value="error",o("error")}}},F=$(g({__name:"lazy-load",props:k,emits:{loaded:()=>!0,error:()=>!0},setup(a){const e=a,{componentId:s,imageStatus:t,showImage:n,handleImageLoadedSuccess:i,handleImageLoadedFailed:d}=x(e),{ns:c,lazyLoadStyle:u}=(a=>({ns:o("lazy-load"),lazyLoadStyle:l((()=>{const e={};return a.width&&(e.width=r(a.width)),a.height&&(e.height=r(a.height)),e}))}))(e);return(a,e)=>{const o=L,l=T;return h(),v(o,{id:y(s),class:f([y(c).b(),y(c).is("show-image",y(n)&&"loaded"===y(t))]),style:I(y(u))},{default:p((()=>["loading"===y(t)?(h(),v(o,{key:0,class:f([y(c).e("container")])},{default:p((()=>[_(a.$slots,"loading",{},(()=>[b(o,{class:f([y(c).e("loading")])},{default:p((()=>[b(o,{class:f([y(c).e("loading__icon")])},{default:p((()=>[b(w,{name:"loading"})])),_:1},8,["class"])])),_:1},8,["class"])]),!0)])),_:3},8,["class"])):S("",!0),y(n)&&"error"!==y(t)?(h(),v(o,{key:1,class:f([y(c).e("container")])},{default:p((()=>[b(l,{class:f([y(c).e("image"),y(c).is("animation","loaded"===y(t)&&a.transition),y(c).is("no-animation","loaded"===y(t)&&!a.transition)]),src:a.src,mode:a.mode,onLoad:y(i),onError:y(d)},null,8,["class","src","mode","onLoad","onError"])])),_:1},8,["class"])):S("",!0),"error"===y(t)?(h(),v(o,{key:2,class:f([y(c).e("container")])},{default:p((()=>[_(a.$slots,"error",{},(()=>[b(o,{class:f([y(c).e("error")])},{default:p((()=>[b(w,{name:"image-fill"})])),_:1},8,["class"])]),!0)])),_:3},8,["class"])):S("",!0)])),_:3},8,["id","class","style"])}}}),[["__scopeId","data-v-2fbad0da"]]);export{F as T};
